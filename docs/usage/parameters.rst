Parameters
==========

This page describes the input parameters for ASL DRO.  These should all be supplied over the
command-line-interface as a json file.  This file has two top-level objects.  A "global_configuration"
object, in which settings that apply to othe running of the instance of ASLDRO are set, and an
image_series" object which defines the settings for each set of reference data that is generated.

Below is an example input parameter file, giving its overall structure.

.. code-block:: json

    {
        "global_configuration": {
            "ground_truth": "hrgt_icbm_2009a_nls_3t",
            "image_override": {},
            "parameter_override": {},
        },
        "image_series": [
            {
                "series_type": "asl",
                "series_description": "an asl image series",
                "series_parameters": {
                }
            },
            {
                "series_type": "structural",
                "series_description": "a structural image series",
                "series_parameters": {
                }
            },
            {
                "series_type": "ground_truth",
                "series_description": "a ground truth image series",
                "series_parameters": {
                }
            }
        ]
    }


Global Configuration
--------------------
The "global_configuration" object is describes key-value pairs that configure how the instance of 
ASLDRO will run:

:ground_truth: (string) Determines which ground truth to be used. See :doc:`ground_truth` for more
    information. At present the following are supported:

    * "hrgt_icbm_2009a_nls_3t" - based on MNI ICBM 2009a Nonlinear Symmetric template, 3T relaxation
      times.
    * "hrgt_icbm_2009a_nls_1.5t" - based on MNI ICBM 2009a Nonlinear Symmetric template, 1.5T relaxation
      times.
:image_override: (object) Contains key/value pairs which will override any of the ground truth images with a given value. For example, if you wish to use a constant "m0", the ``image_override`` should be set to ``{"m0": n}``, where ``n`` is the floating point or integer value required.
:parameter_override: (object) Contains key/value pairs which will override any of the ground truth parameters. For example, you might want to change ``lambda_blood_brain`` to 0.85, in which case you would set ``parameter_override`` to ``{"lambda_blood_brain": 0.85}``.
:ground_truth_modulate: (object) Contains key/value pairs which will modulate any of the ground truth images with a given scale and/or offset. For example, you might want to apply a scale of 0.9 and an offset of 1 to the 'm0' image, therefore, the required dictionary input for 'ground_truth_modulate' would be: ``{"m0":{"scale": 0.9, "offset": 1}}``. Note that the scaling is applied before the offset (see :class:`asldro.filters.scale_offset_filter.ScaleOffsetFilter` for more details).
A more complete example is given below:

.. code-block:: json

    {
        "global_configuration": {
            "ground_truth": "hrgt_icbm_2009a_nls_3t"
            "image_override": {"m0", 5.2},
            "parameter_override": {"lambda_blood_brain": 0.85},
            "ground_truth_modulate": {
                "m0": {"scale": 0.9, "offset": 1},
                "t1": {"offset": 0.5},
                "t2": {"scale": 1.1}
            }
        },
    ...,
    }

Image Series
------------
The "image_series" object is an array, with each entry an object that describes images to generate.
This object has three key-value entries:

:series_type: (string) Specifies which image generation pipeline to run, see below for more details.
:series_description: (string, optional) A string that can be used to describe the image series.
    The value here is added to the field "descrip" in the output NIFTI header, and the BIDS field 
    "Description" in the output .json sidecar of any files generated corresponding to the image series.
:series_parameters: (object, optional) An object containing key-value pairs that configure the image
    series. Some of these parameters are image series specific, for example the parameters that must
    be supplied as arrays for ``series_type`` "asl" are all singleton values for ``series_type``
    "structural". Each ``series_type`` has its own set of default parameters.  This is field is
    omitted then the pipeline will be run using the complete set of default values.

There are three different image generation pipelines built into ASLDRO:

:asl: The full ASL generation pipeline, constructing a time-series of m0, control and label volumes
    with perfusion signal generated by the General Kinetic Model, which is then encoded into
    gradient or spin echo contrast, motion is optionally applied, and an image is acquired at the
    specified acquisition resolution.
:structural: A single volume is generated using gradient echo, spin echo, or inversion recovery 
    contrast, motion optionally applied and an image acquired at the specified acquisition
    resolution. Typically this is used togenerate the structural images such as T1w or FLAIR
    that ASL images are registered to.
:ground_truth: This pipeline simply resamples the input ground truth images to a specified
    resolution.

Parameters for each ``series_type`` are described in the following pages:

:doc:`series-asl`

:doc:`series-structural`

:doc:`series-ground_truth`


